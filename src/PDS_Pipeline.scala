import java.util.Calendar

import org.apache.spark.{SparkConf, SparkContext}
import org.apache.spark.sql._
import org.apache.spark.sql.types._


/**
  * Created by ogt828 on 12/12/16.
  */
object pdsMain {

  def main(args: Array[String]) {

    val inputFile = args(0)
    val outputFile = args(1)


    val conf = new SparkConf().setAppName("Spark PDS Pipeline: ")
    val sc = new SparkContext(conf)

    val starttimestamp = Calendar.getInstance().getTime()

    printf("The program started executing at: " + starttimestamp + "\n")

    val sqlContext = new org.apache.spark.sql.SQLContext(sc)

    val pdsRDD = sc.textFile(inputFile)

    val schemaString = "acct_chain_nbr,acct_seq_nbr,acct_current_max_indicator,ambs_date_last_act,ambs_curr_bal,ambs_block_code_1,ambs_date_block_code_1,ambs_block_code_2,ambs_date_block_code_2,ambs_cb_cr_score,ambs_date_cgoff,ambs_crlim,ambs_date_crlim,ambs_pmt_cycle_due,ambs_int_status,ambs_org,ambs_pmt_tot_amt_due,ambs_fixed_pmt_amt,ambs_date_last_pmt,ambs_amt_last_purch,ambs_date_last_purch,ambs_amt_cgoff,ambs_cash_amt_chgoff,ambs_chgoff_status,ambs_chgoff_rsn1,ambs_chgoff_rsn2,ambs_amt_dispu_items,ambs_nbr_dispu_items,ambs_amt_last_db,ambs_amt_ltd_int_paid,ambs_amt_ltd_pmts,ambs_amt_ltd_purchases,ambs_amt_ltd_returns,ambs_amt_ltd_cash,ambs_nbr_ltd_pmts,ambs_nbr_ltd_purchases,ambs_nbr_ltd_returns,ambs_nbr_ltd_cash,ambs_amt_memo_cr,ambs_amt_memo_db,ambs_amt_ytd_cash,ambs_curr_ytd_int_paid,ambs_hi_ag_partner_code,ambs_hi_ag_affinity_code,ambs_hi_ag_affiliation_code,ambs_hi_ag_sub_affiltn_code,ambs_bu_channel_code,ambs_bu_fi_cs_ind,ambs_bu_lost_stln_type_cd,ambs_bu_merch_source_code,ambs_bu_membership_number,ambs_bu_metro2_code_1,ambs_hi_fi_over_ito_in_effct,ambs_bu_scra_status_0,ambs_income,ambs_cash_balance,ambs_last_cash_adv_dte,ambs_colat_code,ambs_date_bureau,ambs_date_card_fee,ambs_hi_bal,ambs_date_hi_bal,ambs_date_into_coll,ambs_date_last_cr,ambs_date_last_db,ambs_date_last_cycle,ambs_date_last_delq,ambs_date_last_reage,ambs_date_last_return,ambs_date_last_rtn_check,ambs_date_last_stat_chg,ambs_date_last_stmt,ambs_date_next_stmt,ambs_date_late_fee,ambs_date_notific_recvd,ambs_date_pmt_due,ambs_date_xfr_eff,ambs_fi_coll_class,ambs_fi_spid,ambs_fs_flag,ambs_grtst_card_expr_date,ambs_hi_acct_transact_revol,ambs_hi_cit_alt_pct,ambs_hi_cpi_ind,ambs_bu_fraud_fix_pmt,ambs_hi_user_code_28,ambs_hi_user_code_29,ambs_issue_flag,ambs_last_crlim,ambs_last_ytd_int,ambs_last_ytd_int_paid,ambs_lsi_nbr,ambs_mth_bal,ambs_mth_purch,ambs_nbr_nsf,ambs_nbr_plans,ambs_nbr_unblked_cards,ambs_nbr_ytd_late_chg,ambs_nbr_ytd_purchases,ambs_nbr_ytd_returns,ambs_open_to_buy,ambs_owner_flag,ambs_plan_pmt_ovrd_flag,ambs_pmt_curr_due,ambs_pmt_past_ctr,ambs_pmt_past_due,ambs_pmt_30days_ctr,ambs_pmt_30days,ambs_pmt_60days_ctr,ambs_pmt_60days,ambs_pmt_90days_ctr,ambs_pmt_90days,ambs_pmt_120_days_ctr,ambs_pmt_120days,ambs_pmt_150_days_ctr,ambs_pmt_150days,ambs_pmt_180_days_ctr,ambs_pmt_180days,ambs_pmt_days_delq,ambs_pmt_last_amt,ambs_pmt_reaged_by,ambs_pmt_times_manual_reage,ambs_pmt_times_reaged,ambs_rtn_mail_ctr,ambs_short_name,ambs_statement_flag,ambs_user_code_8,ambs_user_date_8,ambs_ytd_billed_int,ambs_intr_state,ambs_pct_start_date,ambs_pct_expir_date,ambs_billing_cycle,ambs_pct_ctl_id,ambs_acct_type,ambs_amt_ytd_late_chg,ambs_amt_ytd_pmts,ambs_amt_ytd_purchases,ambs_amt_ytd_returns,ambs_bu_udap_static_due_date,ambs_si_nbr,ambs_acct,ambs_bu_sister_acct,ambs_cash_crlim,ambs_first_purch_amt,ambs_first_purch_dte,ambs_h_bal_0,ambs_h_delq_0,ambs_h_delq_1,ambs_h_delq_2,ambs_h_delq_3,ambs_h_delq_4,ambs_h_delq_5,ambs_h_delq_6,ambs_h_delq_7,ambs_h_delq_8,ambs_h_delq_9,ambs_h_delq_10,ambs_h_delq_11,ambs_h_delq_12,ambs_h_delq_13,ambs_h_delq_14,ambs_h_delq_15,ambs_h_delq_16,ambs_h_delq_17,ambs_h_delq_18,ambs_h_delq_19,ambs_h_delq_20,ambs_h_delq_21,ambs_h_delq_22,ambs_h_delq_23,ambs_olc_reason,ambs_pmt_ratios_0,ambs_pmt_ratios_1,ambs_state_of_resid,ambs_state_of_issue,ambs_bu_appl_store_nbr,ambs_date_opened,ambs_retail_plan_nbr,ambs_bu_std_plan,ambs_fixed_pmt_pct"

    val fields = schemaString.split(",").map(fieldName => StructField(fieldName, StringType, nullable = true))

    val schema = StructType(fields)

    val rowRDD = pdsRDD.map(_.split("\u0001")).map(attributes => Row(attributes(0).trim, attributes(1).trim, attributes(2).trim, attributes(3).trim, attributes(4).trim, attributes(5).trim, attributes(6).trim, attributes(7).trim, attributes(8).trim, attributes(9).trim, attributes(10).trim, attributes(11).trim, attributes(12).trim, attributes(13).trim, attributes(14).trim, attributes(15).trim, attributes(16).trim, attributes(17).trim, attributes(18).trim, attributes(19).trim, attributes(20).trim, attributes(21).trim, attributes(22).trim, attributes(23).trim, attributes(24).trim, attributes(25).trim, attributes(26).trim, attributes(27).trim, attributes(28).trim, attributes(29).trim, attributes(30).trim, attributes(31).trim, attributes(32).trim, attributes(33).trim, attributes(34).trim, attributes(35).trim, attributes(36).trim, attributes(37).trim, attributes(38).trim, attributes(39).trim, attributes(40).trim, attributes(41).trim, attributes(42).trim, attributes(43).trim, attributes(44).trim, attributes(45).trim, attributes(46).trim, attributes(47).trim, attributes(48).trim, attributes(49).trim, attributes(50).trim, attributes(51).trim, attributes(52).trim, attributes(53).trim, attributes(54).trim, attributes(55).trim, attributes(56).trim, attributes(57).trim, attributes(58).trim, attributes(59).trim, attributes(60).trim, attributes(61).trim, attributes(62).trim, attributes(63).trim, attributes(64).trim, attributes(65).trim, attributes(66).trim, attributes(67).trim, attributes(68).trim, attributes(69).trim, attributes(70).trim, attributes(71).trim, attributes(72).trim, attributes(73).trim, attributes(74).trim, attributes(75).trim, attributes(76).trim, attributes(77).trim, attributes(78).trim, attributes(79).trim, attributes(80).trim, attributes(81).trim, attributes(82).trim, attributes(83).trim, attributes(84).trim, attributes(85).trim, attributes(86).trim, attributes(87).trim, attributes(88).trim, attributes(89).trim, attributes(90).trim, attributes(91).trim, attributes(92).trim, attributes(93).trim, attributes(94).trim, attributes(95).trim, attributes(96).trim, attributes(97).trim, attributes(98).trim, attributes(99).trim, attributes(100).trim, attributes(101).trim, attributes(102).trim, attributes(103).trim, attributes(104).trim, attributes(105).trim, attributes(106).trim, attributes(107).trim, attributes(108).trim, attributes(109).trim, attributes(110).trim, attributes(111).trim, attributes(112).trim, attributes(113).trim, attributes(114).trim, attributes(115).trim, attributes(116).trim, attributes(117).trim, attributes(118).trim, attributes(119).trim, attributes(120).trim, attributes(121).trim, attributes(122).trim, attributes(123).trim, attributes(124).trim, attributes(125).trim, attributes(126).trim, attributes(127).trim, attributes(128).trim, attributes(129).trim, attributes(130).trim, attributes(131).trim, attributes(132).trim, attributes(133).trim, attributes(134).trim, attributes(135).trim, attributes(136).trim, attributes(137).trim, attributes(138).trim, attributes(139).trim, attributes(140).trim, attributes(141).trim, attributes(142).trim, attributes(143).trim, attributes(144).trim, attributes(145).trim, attributes(146).trim, attributes(147).trim, attributes(148).trim, attributes(149).trim, attributes(150).trim, attributes(151).trim, attributes(152).trim, attributes(153).trim, attributes(154).trim, attributes(155).trim, attributes(156).trim, attributes(157).trim, attributes(158).trim, attributes(159).trim, attributes(160).trim, attributes(161).trim, attributes(162).trim, attributes(163).trim, attributes(164).trim, attributes(165).trim, attributes(166).trim, attributes(167).trim, attributes(168).trim, attributes(169).trim, attributes(170).trim, attributes(171).trim, attributes(172).trim, attributes(173).trim, attributes(174).trim, attributes(175).trim, attributes(176).trim, attributes(177).trim, attributes(178).trim, attributes(179).trim, attributes(180).trim))

    //val df = sqlContext.createDataFrame(rowRDD, schema)

    val df = sqlContext.createDataFrame(rowRDD, schema)

    df.registerTempTable("pds")

    val dateValidated = sqlContext.sql("SELECT IF( (isnan(ambs_date_last_act)) AND (length(trim(ambs_date_last_act)) != '6') AND (length(trim(ambs_date_last_act)) != '5'),(IF (isnan(trim(ambs_date_last_act)), '', (IF(length(trim(ambs_date_last_act)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_act), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_act)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_act), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_act)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_act), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_act)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_act), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_act)) = '1' AND trim(ambs_date_last_act) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_act), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_act, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_act, IF( (isnan(ambs_date_block_code_2)) AND (length(trim(ambs_date_block_code_2)) != '6') AND (length(trim(ambs_date_block_code_2)) != '5'),(IF (isnan(trim(ambs_date_block_code_2)), '', (IF(length(trim(ambs_date_block_code_2)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_block_code_2), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_block_code_2)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_block_code_2), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_block_code_2)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_block_code_2), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_block_code_2)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_block_code_2), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_block_code_2)) = '1' AND trim(ambs_date_block_code_2) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_block_code_2), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_block_code_2, 'yyyyDDD')), 'yyyyD')) AS ambs_date_block_code_2, IF( (isnan(ambs_date_cgoff)) AND (length(trim(ambs_date_cgoff)) != '6') AND (length(trim(ambs_date_cgoff)) != '5'),(IF (isnan(trim(ambs_date_cgoff)), '', (IF(length(trim(ambs_date_cgoff)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_cgoff), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_cgoff)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_cgoff), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_cgoff)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_cgoff), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_cgoff)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_cgoff), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_cgoff)) = '1' AND trim(ambs_date_cgoff) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_cgoff), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_cgoff, 'yyyyDDD')), 'yyyyD')) AS ambs_date_cgoff, IF( (isnan(ambs_date_crlim)) AND (length(trim(ambs_date_crlim)) != '6') AND (length(trim(ambs_date_crlim)) != '5'),(IF (isnan(trim(ambs_date_crlim)), '', (IF(length(trim(ambs_date_crlim)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_crlim), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_crlim)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_crlim), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_crlim)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_crlim), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_crlim)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_crlim), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_crlim)) = '1' AND trim(ambs_date_crlim) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_crlim), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_crlim, 'yyyyDDD')), 'yyyyD')) AS ambs_date_crlim, IF( (isnan(ambs_date_last_pmt)) AND (length(trim(ambs_date_last_pmt)) != '6') AND (length(trim(ambs_date_last_pmt)) != '5'),(IF (isnan(trim(ambs_date_last_pmt)), '', (IF(length(trim(ambs_date_last_pmt)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_pmt), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_pmt)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_pmt), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_pmt)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_pmt), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_pmt)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_pmt), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_pmt)) = '1' AND trim(ambs_date_last_pmt) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_pmt), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_pmt, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_pmt, IF( (isnan(ambs_date_last_purch)) AND (length(trim(ambs_date_last_purch)) != '6') AND (length(trim(ambs_date_last_purch)) != '5'),(IF (isnan(trim(ambs_date_last_purch)), '', (IF(length(trim(ambs_date_last_purch)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_purch), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_purch)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_purch), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_purch)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_purch), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_purch)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_purch), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_purch)) = '1' AND trim(ambs_date_last_purch) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_purch), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_purch, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_purch, IF( (isnan(ambs_date_last_stat_chg)) AND (length(trim(ambs_date_last_stat_chg)) != '6') AND (length(trim(ambs_date_last_stat_chg)) != '5'),(IF (isnan(trim(ambs_date_last_stat_chg)), '', (IF(length(trim(ambs_date_last_stat_chg)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_stat_chg), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_stat_chg)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_stat_chg), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_stat_chg)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_stat_chg), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_stat_chg)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_stat_chg), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_stat_chg)) = '1' AND trim(ambs_date_last_stat_chg) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_stat_chg), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_stat_chg, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_stat_chg, IF( (isnan(ambs_last_cash_adv_dte)) AND (length(trim(ambs_last_cash_adv_dte)) != '6') AND (length(trim(ambs_last_cash_adv_dte)) != '5'),(IF (isnan(trim(ambs_last_cash_adv_dte)), '', (IF(length(trim(ambs_last_cash_adv_dte)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_last_cash_adv_dte), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_last_cash_adv_dte)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_last_cash_adv_dte), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_last_cash_adv_dte)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_last_cash_adv_dte), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_last_cash_adv_dte)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_last_cash_adv_dte), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_last_cash_adv_dte)) = '1' AND trim(ambs_last_cash_adv_dte) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_last_cash_adv_dte), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_last_cash_adv_dte, 'yyyyDDD')), 'yyyyD')) AS ambs_last_cash_adv_dte, IF( (isnan(ambs_date_bureau)) AND (length(trim(ambs_date_bureau)) != '6') AND (length(trim(ambs_date_bureau)) != '5'),(IF (isnan(trim(ambs_date_bureau)), '', (IF(length(trim(ambs_date_bureau)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_bureau), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_bureau)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_bureau), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_bureau)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_bureau), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_bureau)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_bureau), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_bureau)) = '1' AND trim(ambs_date_bureau) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_bureau), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_bureau, 'yyyyDDD')), 'yyyyD')) AS ambs_date_bureau, IF( (isnan(ambs_date_card_fee)) AND (length(trim(ambs_date_card_fee)) != '6') AND (length(trim(ambs_date_card_fee)) != '5'),(IF (isnan(trim(ambs_date_card_fee)), '', (IF(length(trim(ambs_date_card_fee)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_card_fee), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_card_fee)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_card_fee), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_card_fee)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_card_fee), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_card_fee)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_card_fee), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_card_fee)) = '1' AND trim(ambs_date_card_fee) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_card_fee), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_card_fee, 'yyyyDDD')), 'yyyyD')) AS ambs_date_card_fee, IF( (isnan(ambs_date_hi_bal)) AND (length(trim(ambs_date_hi_bal)) != '6') AND (length(trim(ambs_date_hi_bal)) != '5'),(IF (isnan(trim(ambs_date_hi_bal)), '', (IF(length(trim(ambs_date_hi_bal)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_hi_bal), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_hi_bal)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_hi_bal), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_hi_bal)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_hi_bal), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_hi_bal)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_hi_bal), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_hi_bal)) = '1' AND trim(ambs_date_hi_bal) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_hi_bal), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_hi_bal, 'yyyyDDD')), 'yyyyD')) AS ambs_date_hi_bal, IF( (isnan(ambs_date_into_coll)) AND (length(trim(ambs_date_into_coll)) != '6') AND (length(trim(ambs_date_into_coll)) != '5'),(IF (isnan(trim(ambs_date_into_coll)), '', (IF(length(trim(ambs_date_into_coll)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_into_coll), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_into_coll)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_into_coll), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_into_coll)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_into_coll), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_into_coll)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_into_coll), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_into_coll)) = '1' AND trim(ambs_date_into_coll) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_into_coll), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_into_coll, 'yyyyDDD')), 'yyyyD')) AS ambs_date_into_coll, IF( (isnan(ambs_date_last_cr)) AND (length(trim(ambs_date_last_cr)) != '6') AND (length(trim(ambs_date_last_cr)) != '5'),(IF (isnan(trim(ambs_date_last_cr)), '', (IF(length(trim(ambs_date_last_cr)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_cr), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_cr)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_cr), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_cr)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_cr), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_cr)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_cr), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_cr)) = '1' AND trim(ambs_date_last_cr) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_cr), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_cr, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_cr, IF( (isnan(ambs_date_last_db)) AND (length(trim(ambs_date_last_db)) != '6') AND (length(trim(ambs_date_last_db)) != '5'),(IF (isnan(trim(ambs_date_last_db)), '', (IF(length(trim(ambs_date_last_db)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_db), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_db)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_db), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_db)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_db), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_db)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_db), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_db)) = '1' AND trim(ambs_date_last_db) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_db), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_db, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_db, IF( (isnan(ambs_date_last_cycle)) AND (length(trim(ambs_date_last_cycle)) != '6') AND (length(trim(ambs_date_last_cycle)) != '5'),(IF (isnan(trim(ambs_date_last_cycle)), '', (IF(length(trim(ambs_date_last_cycle)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_cycle), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_cycle)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_cycle), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_cycle)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_cycle), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_cycle)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_cycle), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_cycle)) = '1' AND trim(ambs_date_last_cycle) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_cycle), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_cycle, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_cycle, IF( (isnan(ambs_date_last_delq)) AND (length(trim(ambs_date_last_delq)) != '6') AND (length(trim(ambs_date_last_delq)) != '5'),(IF (isnan(trim(ambs_date_last_delq)), '', (IF(length(trim(ambs_date_last_delq)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_delq), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_delq)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_delq), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_delq)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_delq), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_delq)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_delq), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_delq)) = '1' AND trim(ambs_date_last_delq) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_delq), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_delq, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_delq, IF( (isnan(ambs_date_last_reage)) AND (length(trim(ambs_date_last_reage)) != '6') AND (length(trim(ambs_date_last_reage)) != '5'),(IF (isnan(trim(ambs_date_last_reage)), '', (IF(length(trim(ambs_date_last_reage)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_reage), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_reage)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_reage), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_reage)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_reage), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_reage)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_reage), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_reage)) = '1' AND trim(ambs_date_last_reage) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_reage), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_reage, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_reage, IF( (isnan(ambs_date_last_return)) AND (length(trim(ambs_date_last_return)) != '6') AND (length(trim(ambs_date_last_return)) != '5'),(IF (isnan(trim(ambs_date_last_return)), '', (IF(length(trim(ambs_date_last_return)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_return), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_return)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_return), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_return)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_return), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_return)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_return), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_return)) = '1' AND trim(ambs_date_last_return) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_return), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_return, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_return, IF( (isnan(ambs_date_last_rtn_check)) AND (length(trim(ambs_date_last_rtn_check)) != '6') AND (length(trim(ambs_date_last_rtn_check)) != '5'),(IF (isnan(trim(ambs_date_last_rtn_check)), '', (IF(length(trim(ambs_date_last_rtn_check)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_rtn_check), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_rtn_check)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_rtn_check), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_rtn_check)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_rtn_check), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_rtn_check)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_rtn_check), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_rtn_check)) = '1' AND trim(ambs_date_last_rtn_check) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_rtn_check), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_rtn_check, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_rtn_check, IF( (isnan(ambs_date_last_stmt)) AND (length(trim(ambs_date_last_stmt)) != '6') AND (length(trim(ambs_date_last_stmt)) != '5'),(IF (isnan(trim(ambs_date_last_stmt)), '', (IF(length(trim(ambs_date_last_stmt)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_last_stmt), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_stmt)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_last_stmt), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_stmt)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_last_stmt), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_last_stmt)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_last_stmt), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_last_stmt)) = '1' AND trim(ambs_date_last_stmt) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_last_stmt), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_last_stmt, 'yyyyDDD')), 'yyyyD')) AS ambs_date_last_stmt, IF( (isnan(ambs_date_next_stmt)) AND (length(trim(ambs_date_next_stmt)) != '6') AND (length(trim(ambs_date_next_stmt)) != '5'),(IF (isnan(trim(ambs_date_next_stmt)), '', (IF(length(trim(ambs_date_next_stmt)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_next_stmt), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_next_stmt)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_next_stmt), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_next_stmt)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_next_stmt), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_next_stmt)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_next_stmt), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_next_stmt)) = '1' AND trim(ambs_date_next_stmt) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_next_stmt), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_next_stmt, 'yyyyDDD')), 'yyyyD')) AS ambs_date_next_stmt, IF( (isnan(ambs_date_late_fee)) AND (length(trim(ambs_date_late_fee)) != '6') AND (length(trim(ambs_date_late_fee)) != '5'),(IF (isnan(trim(ambs_date_late_fee)), '', (IF(length(trim(ambs_date_late_fee)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_late_fee), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_late_fee)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_late_fee), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_late_fee)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_late_fee), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_late_fee)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_late_fee), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_late_fee)) = '1' AND trim(ambs_date_late_fee) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_late_fee), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_late_fee, 'yyyyDDD')), 'yyyyD')) AS ambs_date_late_fee, IF( (isnan(ambs_date_notific_recvd)) AND (length(trim(ambs_date_notific_recvd)) != '6') AND (length(trim(ambs_date_notific_recvd)) != '5'),(IF (isnan(trim(ambs_date_notific_recvd)), '', (IF(length(trim(ambs_date_notific_recvd)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_notific_recvd), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_notific_recvd)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_notific_recvd), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_notific_recvd)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_notific_recvd), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_notific_recvd)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_notific_recvd), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_notific_recvd)) = '1' AND trim(ambs_date_notific_recvd) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_notific_recvd), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_notific_recvd, 'yyyyDDD')), 'yyyyD')) AS ambs_date_notific_recvd, IF( (isnan(ambs_date_pmt_due)) AND (length(trim(ambs_date_pmt_due)) != '6') AND (length(trim(ambs_date_pmt_due)) != '5'),(IF (isnan(trim(ambs_date_pmt_due)), '', (IF(length(trim(ambs_date_pmt_due)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_pmt_due), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_pmt_due)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_pmt_due), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_pmt_due)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_pmt_due), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_pmt_due)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_pmt_due), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_pmt_due)) = '1' AND trim(ambs_date_pmt_due) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_pmt_due), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_pmt_due, 'yyyyDDD')), 'yyyyD')) AS ambs_date_pmt_due, IF( (isnan(ambs_date_xfr_eff)) AND (length(trim(ambs_date_xfr_eff)) != '6') AND (length(trim(ambs_date_xfr_eff)) != '5'),(IF (isnan(trim(ambs_date_xfr_eff)), '', (IF(length(trim(ambs_date_xfr_eff)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_xfr_eff), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_xfr_eff)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_xfr_eff), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_xfr_eff)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_xfr_eff), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_xfr_eff)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_xfr_eff), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_xfr_eff)) = '1' AND trim(ambs_date_xfr_eff) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_xfr_eff), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_xfr_eff, 'yyyyDDD')), 'yyyyD')) AS ambs_date_xfr_eff, IF( (isnan(ambs_user_date_8)) AND (length(trim(ambs_user_date_8)) != '6') AND (length(trim(ambs_user_date_8)) != '5'),(IF (isnan(trim(ambs_user_date_8)), '', (IF(length(trim(ambs_user_date_8)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_user_date_8), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_user_date_8)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_user_date_8), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_user_date_8)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_user_date_8), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_user_date_8)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_user_date_8), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_user_date_8)) = '1' AND trim(ambs_user_date_8) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_user_date_8), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_user_date_8, 'yyyyDDD')), 'yyyyD')) AS ambs_user_date_8, IF( (isnan(ambs_pct_start_date)) AND (length(trim(ambs_pct_start_date)) != '6') AND (length(trim(ambs_pct_start_date)) != '5'),(IF (isnan(trim(ambs_pct_start_date)), '', (IF(length(trim(ambs_pct_start_date)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_pct_start_date), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_pct_start_date)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_pct_start_date), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_pct_start_date)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_pct_start_date), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_pct_start_date)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_pct_start_date), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_pct_start_date)) = '1' AND trim(ambs_pct_start_date) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_pct_start_date), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_pct_start_date, 'yyyyDDD')), 'yyyyD')) AS ambs_pct_start_date, IF( (isnan(ambs_pct_expir_date)) AND (length(trim(ambs_pct_expir_date)) != '6') AND (length(trim(ambs_pct_expir_date)) != '5'),(IF (isnan(trim(ambs_pct_expir_date)), '', (IF(length(trim(ambs_pct_expir_date)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_pct_expir_date), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_pct_expir_date)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_pct_expir_date), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_pct_expir_date)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_pct_expir_date), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_pct_expir_date)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_pct_expir_date), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_pct_expir_date)) = '1' AND trim(ambs_pct_expir_date) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_pct_expir_date), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_pct_expir_date, 'yyyyDDD')), 'yyyyD')) AS ambs_pct_expir_date, IF( (isnan(ambs_date_opened)) AND (length(trim(ambs_date_opened)) != '6') AND (length(trim(ambs_date_opened)) != '5'),(IF (isnan(trim(ambs_date_opened)), '', (IF(length(trim(ambs_date_opened)) = '5', date_format(from_unixtime(unix_timestamp(concat('19',ambs_date_opened), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_opened)) = '4', date_format(from_unixtime(unix_timestamp(concat('200',ambs_date_opened), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_opened)) = '3', date_format(from_unixtime(unix_timestamp(concat('2000',ambs_date_opened), 'yyyyDDD')), 'yyyyD'), (IF(length(trim(ambs_date_opened)) = '2', date_format(from_unixtime(unix_timestamp(concat('20000',ambs_date_opened), 'yyyyDDD')), 'yyyyD'), (IF( length(trim(ambs_date_opened)) = '1' AND trim(ambs_date_opened) != '0', date_format(from_unixtime(unix_timestamp(concat('200000',ambs_date_opened), 'yyyyDDD')), 'yyyyD'), '' )))))))))))),  date_format(from_unixtime(unix_timestamp(ambs_date_opened, 'yyyyDDD')), 'yyyyD')) AS ambs_date_opened, IF (ambs_acct_type = 'X', IF(trim(ambs_acct_type) = '', '~', trim(ambs_state_of_issue)), IF(trim(ambs_state_of_resid) = '', '~', trim(ambs_state_of_resid)) ) AS output_acct_type, IF(trim(ambs_pct_ctl_id) = '', '~', trim(ambs_pct_ctl_id)) AS ambs_pct_ctl_id, IF (isnan(ambs_h_delq_0), '0', ambs_h_delq_0) AS ambs_h_delq_0, IF (isnan(ambs_h_delq_1), '0', ambs_h_delq_1) AS ambs_h_delq_1, IF (isnan(ambs_h_delq_2), '0', ambs_h_delq_2) AS ambs_h_delq_2, IF (isnan(ambs_h_delq_3), '0', ambs_h_delq_3) AS ambs_h_delq_3, IF (isnan(ambs_h_delq_4), '0', ambs_h_delq_4) AS ambs_h_delq_4, IF (isnan(ambs_h_delq_5), '0', ambs_h_delq_5) AS ambs_h_delq_5, IF (isnan(ambs_h_delq_6), '0', ambs_h_delq_6) AS ambs_h_delq_6, IF (isnan(ambs_h_delq_7), '0', ambs_h_delq_7) AS ambs_h_delq_7, IF (isnan(ambs_h_delq_8), '0', ambs_h_delq_8) AS ambs_h_delq_8, IF (isnan(ambs_h_delq_9), '0', ambs_h_delq_9) AS ambs_h_delq_9, IF (isnan(ambs_h_delq_10), '0', ambs_h_delq_10) AS ambs_h_delq_10, IF (isnan(ambs_h_delq_11), '0', ambs_h_delq_11) AS ambs_h_delq_11, IF (isnan(ambs_h_delq_12), '0', ambs_h_delq_12) AS ambs_h_delq_12, IF (isnan(ambs_h_delq_13), '0', ambs_h_delq_13) AS ambs_h_delq_13, IF (isnan(ambs_h_delq_14), '0', ambs_h_delq_14) AS ambs_h_delq_14, IF (isnan(ambs_h_delq_15), '0', ambs_h_delq_15) AS ambs_h_delq_15, IF (isnan(ambs_h_delq_16), '0', ambs_h_delq_16) AS ambs_h_delq_16, IF (isnan(ambs_h_delq_17), '0', ambs_h_delq_17) AS ambs_h_delq_17, IF (isnan(ambs_h_delq_18), '0', ambs_h_delq_18) AS ambs_h_delq_18, IF (isnan(ambs_h_delq_19), '0', ambs_h_delq_19) AS ambs_h_delq_19, IF (isnan(ambs_h_delq_20), '0', ambs_h_delq_20) AS ambs_h_delq_20, IF (isnan(ambs_h_delq_21), '0', ambs_h_delq_21) AS ambs_h_delq_21, IF (isnan(ambs_h_delq_22), '0', ambs_h_delq_22) AS ambs_h_delq_22, IF (isnan(ambs_h_delq_23), '0', ambs_h_delq_23) AS ambs_h_delq_23, acct_chain_nbr, acct_seq_nbr, acct_current_max_indicator, ambs_curr_bal, ambs_block_code_1, ambs_date_block_code_1, ambs_block_code_2, ambs_cb_cr_score, ambs_crlim, ambs_pmt_cycle_due, ambs_int_status, ambs_org, ambs_pmt_tot_amt_due, ambs_fixed_pmt_amt, ambs_amt_last_purch, ambs_amt_cgoff, ambs_cash_amt_chgoff, ambs_chgoff_status, ambs_chgoff_rsn1, ambs_chgoff_rsn2, ambs_amt_dispu_items, ambs_nbr_dispu_items, ambs_amt_last_db, ambs_amt_ltd_int_paid, ambs_amt_ltd_pmts, ambs_amt_ltd_purchases, ambs_amt_ltd_returns, ambs_amt_ltd_cash, ambs_nbr_ltd_pmts, ambs_nbr_ltd_purchases, ambs_nbr_ltd_returns, ambs_nbr_ltd_cash, ambs_amt_memo_cr, ambs_amt_memo_db, ambs_amt_ytd_cash, ambs_curr_ytd_int_paid, ambs_hi_ag_partner_code, ambs_hi_ag_affinity_code, ambs_hi_ag_affiliation_code, ambs_hi_ag_sub_affiltn_code, ambs_bu_channel_code, ambs_bu_fi_cs_ind, ambs_bu_lost_stln_type_cd, ambs_bu_merch_source_code, ambs_bu_membership_number, ambs_bu_metro2_code_1, ambs_hi_fi_over_ito_in_effct, ambs_bu_scra_status_0, ambs_income, ambs_cash_balance, ambs_colat_code, ambs_hi_bal, ambs_fi_coll_class, ambs_fi_spid, ambs_fs_flag, ambs_grtst_card_expr_date, ambs_hi_acct_transact_revol, ambs_hi_cit_alt_pct, ambs_hi_cpi_ind, ambs_bu_fraud_fix_pmt, ambs_hi_user_code_28, ambs_hi_user_code_29, ambs_issue_flag, ambs_last_crlim, ambs_last_ytd_int, ambs_last_ytd_int_paid, ambs_lsi_nbr, ambs_mth_bal, ambs_mth_purch, ambs_nbr_nsf, ambs_nbr_plans, ambs_nbr_unblked_cards, ambs_nbr_ytd_late_chg, ambs_nbr_ytd_purchases, ambs_nbr_ytd_returns, ambs_open_to_buy, ambs_owner_flag, ambs_plan_pmt_ovrd_flag, ambs_pmt_curr_due, ambs_pmt_past_ctr, ambs_pmt_past_due, ambs_pmt_30days_ctr, ambs_pmt_30days, ambs_pmt_60days_ctr, ambs_pmt_60days, ambs_pmt_90days_ctr, ambs_pmt_90days, ambs_pmt_120_days_ctr, ambs_pmt_120days, ambs_pmt_150_days_ctr, ambs_pmt_150days, ambs_pmt_180_days_ctr, ambs_pmt_180days, ambs_pmt_days_delq, ambs_pmt_last_amt, ambs_pmt_reaged_by, ambs_pmt_times_manual_reage, ambs_pmt_times_reaged, ambs_rtn_mail_ctr, ambs_short_name, ambs_statement_flag, ambs_user_code_8, ambs_ytd_billed_int, ambs_intr_state, ambs_billing_cycle, ambs_acct_type, ambs_amt_ytd_late_chg, ambs_amt_ytd_pmts, ambs_amt_ytd_purchases, ambs_amt_ytd_returns, ambs_bu_udap_static_due_date, ambs_si_nbr, ambs_acct, ambs_bu_sister_acct, ambs_cash_crlim, ambs_first_purch_amt, ambs_first_purch_dte, ambs_h_bal_0, ambs_olc_reason, ambs_pmt_ratios_0, ambs_pmt_ratios_1, ambs_state_of_resid, ambs_state_of_issue, ambs_bu_appl_store_nbr, ambs_retail_plan_nbr, ambs_bu_std_plan, ambs_fixed_pmt_pct FROM pds")

    dateValidated.registerTempTable("dateValidated")


    val BigTrans10_11 = sqlContext.sql("SELECT IF(ambs_plan_pmt_ovrd_flag in ('P','B','Q') , ambs_fixed_pmt_pct, ambs_fixed_pmt_amt), ambs_plan_pmt_ovrd_flag,ambs_fixed_pmt_pct, ambs_fixed_pmt_amt AS FIXED_PAYMENT_PERCENTAGE_OR_AMOUNT, IF (ambs_int_status in ('A','D','I','N','M') AND (ambs_crlim > 5) AND  (ambs_block_code_1 in ('A','P','X','J','Y','H','Q','S','T','V') OR trim(ambs_block_code_1) = '' OR (length(ambs_block_code_2) = 0)) AND (ambs_block_code_1 in ('A','P','X','J','Y','H','Q','S','T','V') OR trim(ambs_block_code_1) = '' OR (length(ambs_block_code_2) = 0)) AND (ambs_acct_type = 'X' AND  from_unixtime(unix_timestamp(ambs_date_last_stat_chg, 'yyyyDDD')) > current_date() OR ambs_acct_type != 'X'), 'Y', 'N') AS OPEN_IND, greatest(ambs_h_delq_0,ambs_h_delq_1,ambs_h_delq_2,ambs_h_delq_3,ambs_h_delq_4,ambs_h_delq_5,ambs_h_delq_6,ambs_h_delq_7,ambs_h_delq_8,ambs_h_delq_9,ambs_h_delq_10,ambs_h_delq_11,ambs_h_delq_12,ambs_h_delq_13,ambs_h_delq_14,ambs_h_delq_15,ambs_h_delq_16,ambs_h_delq_17,ambs_h_delq_18,ambs_h_delq_19,ambs_h_delq_20,ambs_h_delq_21,ambs_h_delq_22,ambs_h_delq_23) AS HIGHEST_AGE_LAST_24_MONTHS, (IF(ambs_h_delq_0 = 2, 1, 0)) + (IF(ambs_h_delq_1 = 2, 1, 0)) + (IF(ambs_h_delq_2 = 2, 1, 0)) + (IF(ambs_h_delq_3 = 2, 1, 0)) + (IF(ambs_h_delq_4 = 2, 1, 0)) + (IF(ambs_h_delq_5 = 2, 1, 0)) + (IF(ambs_h_delq_6 = 2, 1, 0)) + (IF(ambs_h_delq_7 = 2, 1, 0)) + (IF(ambs_h_delq_8 = 2, 1, 0)) + (IF(ambs_h_delq_9 = 2, 1, 0)) + (IF(ambs_h_delq_10 = 2, 1, 0)) + (IF(ambs_h_delq_11 = 2, 1, 0)) AS past_due_last12_mth, (IF(ambs_h_delq_12 = 2, 1, 0)) + (IF(ambs_h_delq_13 = 2, 1, 0)) + (IF(ambs_h_delq_14 = 2, 1, 0)) + (IF(ambs_h_delq_15 = 2, 1, 0)) + (IF(ambs_h_delq_16 = 2, 1, 0)) + (IF(ambs_h_delq_17 = 2, 1, 0)) + (IF(ambs_h_delq_18 = 2, 1, 0)) + (IF(ambs_h_delq_19 = 2, 1, 0)) + (IF(ambs_h_delq_20 = 2, 1, 0)) + (IF(ambs_h_delq_21 = 2, 1, 0)) + (IF(ambs_h_delq_22 = 2, 1, 0)) + (IF(ambs_h_delq_23 = 2, 1, 0)) AS past_due_last24_mth, IF(isnan(ambs_date_last_stat_chg), '0.00', IF (year(from_unixtime(unix_timestamp(ambs_date_last_stat_chg, 'yyyyDDD'))) = year(current_date()), ambs_amt_ytd_cash, '0' )) AS CASH_AMOUNT_YEAR_TO_DATE, IF(isnan(ambs_date_last_stat_chg), '0.00', IF (year(from_unixtime(unix_timestamp(ambs_date_last_stat_chg, 'yyyyDDD'))) = year(current_date()), ambs_amt_ytd_late_chg, '0' )) AS LATE_FEE_AMOUNT_YEAR_TO_DATE, IF(isnan(ambs_date_last_stat_chg), '0.00', IF (year(from_unixtime(unix_timestamp(ambs_date_last_stat_chg, 'yyyyDDD'))) = year(current_date()), ambs_amt_ytd_pmts, '0' )) AS PAYMENT_AMOUNT_YEAR_TO_DATE, IF(isnan(ambs_date_last_stat_chg), '0.00', IF (year(from_unixtime(unix_timestamp(ambs_date_last_stat_chg, 'yyyyDDD'))) = year(current_date()), ambs_amt_ytd_purchases, '0' )) AS PURCHASE_AMOUNT_YEAR_TO_DATE, IF(isnan(ambs_date_last_stat_chg), '0.00', IF (year(from_unixtime(unix_timestamp(ambs_date_last_stat_chg, 'yyyyDDD'))) = year(current_date()), ambs_amt_ytd_returns, '0' )) AS RETURN_AMOUNT_YEAR_TO_DATE, (IF(ambs_h_delq_0 = 3, 1, 0)) + (IF(ambs_h_delq_1 = 3, 1, 0)) + (IF(ambs_h_delq_2 = 3, 1, 0)) + (IF(ambs_h_delq_3 = 3, 1, 0)) + (IF(ambs_h_delq_4 = 3, 1, 0)) + (IF(ambs_h_delq_5 = 3, 1, 0)) + (IF(ambs_h_delq_6 = 3, 1, 0)) + (IF(ambs_h_delq_7 = 3, 1, 0)) + (IF(ambs_h_delq_8 = 3, 1, 0)) + (IF(ambs_h_delq_9 = 3, 1, 0)) + (IF(ambs_h_delq_10 = 3, 1, 0)) + (IF(ambs_h_delq_11 = 3, 1, 0)) AS 30_DAYS_DELINQUENT_QUANTITY_LAST_12_MONTHS, (IF(ambs_h_delq_12 = 3, 1, 0)) + (IF(ambs_h_delq_13 = 3, 1, 0)) + (IF(ambs_h_delq_14 = 3, 1, 0)) + (IF(ambs_h_delq_15 = 3, 1, 0)) + (IF(ambs_h_delq_16 = 3, 1, 0)) + (IF(ambs_h_delq_17 = 3, 1, 0)) + (IF(ambs_h_delq_18 = 3, 1, 0)) + (IF(ambs_h_delq_19 = 3, 1, 0)) + (IF(ambs_h_delq_20 = 3, 1, 0)) + (IF(ambs_h_delq_21 = 3, 1, 0)) + (IF(ambs_h_delq_22 = 3, 1, 0)) + (IF(ambs_h_delq_23 = 3, 1, 0)) AS 30_DAYS_DELINQUENT_QUANTITY_LAST_13_24_MONTHS, (IF(ambs_h_delq_0 = 4, 1, 0)) + (IF(ambs_h_delq_1 = 4, 1, 0)) + (IF(ambs_h_delq_2 = 4, 1, 0)) + (IF(ambs_h_delq_3 = 4, 1, 0)) + (IF(ambs_h_delq_4 = 4, 1, 0)) + (IF(ambs_h_delq_5 = 4, 1, 0)) + (IF(ambs_h_delq_6 = 4, 1, 0)) + (IF(ambs_h_delq_7 = 4, 1, 0)) + (IF(ambs_h_delq_8 = 4, 1, 0)) + (IF(ambs_h_delq_9 = 4, 1, 0)) + (IF(ambs_h_delq_10 = 4, 1, 0)) + (IF(ambs_h_delq_11 = 4, 1, 0)) AS 60_DAYS_DELINQUENT_QUANTITY_LAST_12_MONTHS, (IF(ambs_h_delq_12 = 4, 1, 0)) + (IF(ambs_h_delq_13 = 4, 1, 0)) + (IF(ambs_h_delq_14 = 4, 1, 0)) + (IF(ambs_h_delq_15 = 4, 1, 0)) + (IF(ambs_h_delq_16 = 4, 1, 0)) + (IF(ambs_h_delq_17 = 4, 1, 0)) + (IF(ambs_h_delq_18 = 4, 1, 0)) + (IF(ambs_h_delq_19 = 4, 1, 0)) + (IF(ambs_h_delq_20 = 4, 1, 0)) + (IF(ambs_h_delq_21 = 4, 1, 0)) + (IF(ambs_h_delq_22 = 4, 1, 0)) + (IF(ambs_h_delq_23 = 4, 1, 0)) AS 60_DAYS_DELINQUENT_QUANTITY_LAST_13_24_MONTHS, (IF(ambs_h_delq_0 = 5, 1, 0)) + (IF(ambs_h_delq_1 = 5, 1, 0)) + (IF(ambs_h_delq_2 = 5, 1, 0)) + (IF(ambs_h_delq_3 = 5, 1, 0)) + (IF(ambs_h_delq_4 = 5, 1, 0)) + (IF(ambs_h_delq_5 = 5, 1, 0)) + (IF(ambs_h_delq_6 = 5, 1, 0)) + (IF(ambs_h_delq_7 = 5, 1, 0)) + (IF(ambs_h_delq_8 = 5, 1, 0)) + (IF(ambs_h_delq_9 = 5, 1, 0)) + (IF(ambs_h_delq_10 = 5, 1, 0)) + (IF(ambs_h_delq_11 = 5, 1, 0)) AS 90_PLUS_DAYS_DELINQUENT_QUANTITY_LAST_12_MONTHS, (IF(ambs_h_delq_12 = 5, 1, 0)) + (IF(ambs_h_delq_13 = 5, 1, 0)) + (IF(ambs_h_delq_14 = 5, 1, 0)) + (IF(ambs_h_delq_15 = 5, 1, 0)) + (IF(ambs_h_delq_16 = 5, 1, 0)) + (IF(ambs_h_delq_17 = 5, 1, 0)) + (IF(ambs_h_delq_18 = 5, 1, 0)) + (IF(ambs_h_delq_19 = 5, 1, 0)) + (IF(ambs_h_delq_20 = 5, 1, 0)) + (IF(ambs_h_delq_21 = 5, 1, 0)) + (IF(ambs_h_delq_22 = 5, 1, 0)) + (IF(ambs_h_delq_23 = 5, 1, 0)) AS 90_PLUS_DAYS_DELINQUENT_QUANTITY_LAST_13_24_MONTHS, IF(isnan(from_unixtime(unix_timestamp(ambs_pct_start_date, 'yyyyDDD'))) OR isnan(from_unixtime(unix_timestamp(ambs_pct_start_date, 'yyyyDDD'))), 'N', IF(trim(ambs_pct_ctl_id) != '' AND (from_unixtime(unix_timestamp(ambs_pct_start_date, 'yyyyDDD')) <= current_date() ) AND ( ambs_pct_expir_date = '' OR  (from_unixtime(unix_timestamp(ambs_pct_start_date, 'yyyyDDD')) >= add_months(current_date(), 25) )), 'Y', 'N') ) AS OVERRIDE_PRICING_TYPE, IF(ambs_bu_udap_static_due_date > 0 AND ambs_bu_udap_static_due_date < 29, IF(ambs_bu_udap_static_due_date > rint(substring(current_date(), 6, 7)), concat(substring(current_date(), 0, 6), substring(ambs_bu_udap_static_due_date + 100, 0,1)), concat(substring(regexp_replace(add_months(current_date(),1),'-',''),0,6), substring(ambs_bu_udap_static_due_date + 100, 0,1))),'') AS NEXT_PAYMENT_DUE_DATE, IF (isnan(from_unixtime(unix_timestamp(ambs_date_opened, 'yyyyDDD'))), '0', 12 * ( year(current_date()) -  year(from_unixtime(unix_timestamp(ambs_date_opened, 'yyyyDDD')))) + (month(current_date()) -  year(from_unixtime(unix_timestamp(ambs_date_opened, 'yyyyDDD'))) -1 )) AS CYCLES_OPEN, IF(trim(output_acct_type) = '~' AND trim(ambs_pct_ctl_id) = '~' OR (trim(ambs_pct_ctl_id) != '~' AND (isnan(from_unixtime(unix_timestamp(ambs_pct_start_date), 'yyyyDDD')) AND (from_unixtime(unix_timestamp(ambs_pct_start_date), 'yyyyDDD')) >  current_date())  OR (isnan(from_unixtime(unix_timestamp(ambs_pct_expir_date), 'yyyyDDD')) AND (from_unixtime(unix_timestamp(ambs_pct_expir_date), 'yyyyDDD')) <= current_date())), 'P', 'A') AS PRICING_TYPE, IF(trim(output_acct_type) = '~' AND trim(ambs_pct_ctl_id) = '~' OR (trim(ambs_pct_ctl_id) != '~' AND (isnan(from_unixtime(unix_timestamp(ambs_pct_start_date), 'yyyyDDD')) AND (from_unixtime(unix_timestamp(ambs_pct_start_date), 'yyyyDDD')) >  current_date())  OR (isnan(from_unixtime(unix_timestamp(ambs_pct_expir_date), 'yyyyDDD')) AND (from_unixtime(unix_timestamp(ambs_pct_expir_date), 'yyyyDDD')) <= current_date())), 'STD', 'OVR') AS PRICE_METHOD_CODE, acct_chain_nbr, acct_seq_nbr, acct_current_max_indicator, ambs_date_last_act, ambs_curr_bal, ambs_block_code_1, ambs_date_block_code_1, ambs_block_code_2, ambs_date_block_code_2, ambs_cb_cr_score, ambs_date_cgoff, ambs_crlim, ambs_date_crlim, ambs_pmt_cycle_due, ambs_int_status, ambs_org, ambs_pmt_tot_amt_due, ambs_fixed_pmt_amt, ambs_date_last_pmt, ambs_amt_last_purch, ambs_date_last_purch, ambs_amt_cgoff, ambs_cash_amt_chgoff, ambs_chgoff_status, ambs_chgoff_rsn1, ambs_chgoff_rsn2, ambs_amt_dispu_items, ambs_nbr_dispu_items, ambs_amt_last_db, ambs_amt_ltd_int_paid, ambs_amt_ltd_pmts, ambs_amt_ltd_purchases, ambs_amt_ltd_returns, ambs_amt_ltd_cash, ambs_nbr_ltd_pmts, ambs_nbr_ltd_purchases, ambs_nbr_ltd_returns, ambs_nbr_ltd_cash, ambs_amt_memo_cr, ambs_amt_memo_db, ambs_amt_ytd_cash, ambs_curr_ytd_int_paid, ambs_hi_ag_partner_code, ambs_hi_ag_affinity_code, ambs_hi_ag_affiliation_code, ambs_hi_ag_sub_affiltn_code, ambs_bu_channel_code, ambs_bu_fi_cs_ind, ambs_bu_lost_stln_type_cd, ambs_bu_merch_source_code, ambs_bu_membership_number, ambs_bu_metro2_code_1, ambs_hi_fi_over_ito_in_effct, ambs_bu_scra_status_0, ambs_income, ambs_cash_balance, ambs_last_cash_adv_dte, ambs_colat_code, ambs_date_bureau, ambs_date_card_fee, ambs_hi_bal, ambs_date_hi_bal, ambs_date_into_coll, ambs_date_last_cr, ambs_date_last_db, ambs_date_last_cycle, ambs_date_last_delq, ambs_date_last_reage, ambs_date_last_return, ambs_date_last_rtn_check, ambs_date_last_stat_chg, ambs_date_last_stmt, ambs_date_next_stmt, ambs_date_late_fee, ambs_date_notific_recvd, ambs_date_pmt_due, ambs_date_xfr_eff, ambs_fi_coll_class, ambs_fi_spid, ambs_fs_flag, ambs_grtst_card_expr_date, ambs_hi_acct_transact_revol, ambs_hi_cit_alt_pct, ambs_hi_cpi_ind, ambs_bu_fraud_fix_pmt, ambs_hi_user_code_28, ambs_hi_user_code_29, ambs_issue_flag, ambs_last_crlim, ambs_last_ytd_int, ambs_last_ytd_int_paid, ambs_lsi_nbr, ambs_mth_bal, ambs_mth_purch, ambs_nbr_nsf, ambs_nbr_plans, ambs_nbr_unblked_cards, ambs_nbr_ytd_late_chg, ambs_nbr_ytd_purchases, ambs_nbr_ytd_returns, ambs_open_to_buy, ambs_owner_flag, ambs_plan_pmt_ovrd_flag, ambs_pmt_curr_due, ambs_pmt_past_ctr, ambs_pmt_past_due, ambs_pmt_30days_ctr, ambs_pmt_30days, ambs_pmt_60days_ctr, ambs_pmt_60days, ambs_pmt_90days_ctr, ambs_pmt_90days, ambs_pmt_120_days_ctr, ambs_pmt_120days, ambs_pmt_150_days_ctr, ambs_pmt_150days, ambs_pmt_180_days_ctr, ambs_pmt_180days, ambs_pmt_days_delq, ambs_pmt_last_amt, ambs_pmt_reaged_by, ambs_pmt_times_manual_reage, ambs_pmt_times_reaged, ambs_rtn_mail_ctr, ambs_short_name, ambs_statement_flag, ambs_user_code_8, ambs_user_date_8, ambs_ytd_billed_int, ambs_intr_state, ambs_pct_start_date, ambs_pct_expir_date, ambs_billing_cycle, ambs_pct_ctl_id, ambs_acct_type, ambs_amt_ytd_late_chg, ambs_amt_ytd_pmts, ambs_amt_ytd_purchases, ambs_amt_ytd_returns, ambs_bu_udap_static_due_date, ambs_si_nbr, ambs_acct, ambs_bu_sister_acct, ambs_cash_crlim, ambs_first_purch_amt, ambs_first_purch_dte, ambs_h_bal_0, ambs_h_delq_0, ambs_h_delq_1, ambs_h_delq_2, ambs_h_delq_3, ambs_h_delq_4, ambs_h_delq_5, ambs_h_delq_6, ambs_h_delq_7, ambs_h_delq_8, ambs_h_delq_9, ambs_h_delq_10, ambs_h_delq_11, ambs_h_delq_12, ambs_h_delq_13, ambs_h_delq_14, ambs_h_delq_15, ambs_h_delq_16, ambs_h_delq_17, ambs_h_delq_18, ambs_h_delq_19, ambs_h_delq_20, ambs_h_delq_21, ambs_h_delq_22, ambs_h_delq_23, ambs_olc_reason, ambs_pmt_ratios_0, ambs_pmt_ratios_1, ambs_state_of_resid, ambs_state_of_issue, ambs_bu_appl_store_nbr, ambs_date_opened, ambs_retail_plan_nbr, ambs_bu_std_plan, ambs_fixed_pmt_pct FROM dateValidated")

    BigTrans10_11.registerTempTable("BigTrans10_11")


    val FinalTransformations = sqlContext.sql("SELECT acct_chain_nbr AS ATHCHAIN_NUMBER, acct_seq_nbr AS ATH_SEQUENCE_NUMBER, current_date() AS SNAP_DATE, '12-31-2100' AS SNAP_END_DATE, acct_current_max_indicator AS ACTV_IND, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_act), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_act, 'yyyyD')), 'yyyyMMdd') ) AS LAST_ACTIVITY_DATE, IF(isnan(ambs_curr_bal), '',ambs_curr_bal) AS CURRENT_BALANCE, IF(isnan(from_unixtime(unix_timestamp(ambs_date_block_code_1), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_block_code_1, 'yyyyD')), 'yyyyMMdd') ) AS BLOCK_CODE_1_DATE, IF(isnan(from_unixtime(unix_timestamp(ambs_date_block_code_2), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_block_code_2, 'yyyyD')), 'yyyyMMdd') ) AS BLOCK_CODE_2_DATE, IF(isnan(from_unixtime(unix_timestamp(ambs_date_cgoff), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_cgoff, 'yyyyD')), 'yyyyMMdd') ) AS CHARGE_OFF_DATE, IF(isnan(from_unixtime(unix_timestamp(ambs_date_crlim), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_crlim, 'yyyyD')), 'yyyyMMdd') ) AS LAST_CREDIT_LIMIT_CHANGE_DATE, IF(ambs_curr_bal IS NULL, '0',ambs_curr_bal) AS CURRENT_BALANCE, substring((acct_seq_nbr + 1000), 0,1) AS ORGANIZATION, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_pmt), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_pmt, 'yyyyD')), 'yyyyMMdd') ) AS LAST_PAYMENT_PERCENTAGE_OR_AMOUNT, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_purch), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_purch, 'yyyyD')), 'yyyyMMdd') ) AS LAST_PURCHASE_DATE, format_number(rint((ambs_amt_ltd_returns)/100), 2) AS RETURN_AMOUNT_LIFE_TO_DATE, ltrim(ambs_bu_membership_number) AS MERCHANT_MEMBER_NUMBER, IF(isnan(ambs_income), '',ambs_income) AS AMBS_INCOME, IF(isnan(rint(ambs_cash_balance)), '',ambs_cash_balance) AS AMBS_CASH_BALANCE, IF(isnan(from_unixtime(unix_timestamp(ambs_last_cash_adv_dte), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_last_cash_adv_dte, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_LAST_CASE_ADV_DTE, trim(ambs_colat_code) AS AMBS_COLAT_CODE, IF(isnan(from_unixtime(unix_timestamp(ambs_date_bureau), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_bureau, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_BUREAU, IF(isnan(from_unixtime(unix_timestamp(ambs_date_card_fee), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_card_fee, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_CARD_FEE, IF(isnan(ambs_hi_bal), '',ambs_hi_bal) AS AMBS_HI_BAL, IF(isnan(from_unixtime(unix_timestamp(ambs_date_hi_bal), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_hi_bal, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_HI_BAL, IF(isnan(from_unixtime(unix_timestamp(ambs_date_into_coll), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_into_coll, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_INTO_COLL, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_cr), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_cr, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_LAST_CR, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_db), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_db, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_LAST_DB, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_cycle), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_cycle, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_LAST_CYCLE, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_delq), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_delq, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_LAST_DELQ, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_reage), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_reage, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_LAST_REAGE, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_return), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_return, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_LAST_RETURN, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_rtn_check), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_rtn_check, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_LAST_RTN_CHECK, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_stat_chg), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_stat_chg, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_LAST_STAT_CHG, IF(isnan(from_unixtime(unix_timestamp(ambs_date_last_stmt), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_last_stmt, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_LAST_STMT, IF(isnan(from_unixtime(unix_timestamp(ambs_date_next_stmt), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_next_stmt, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_NEXT_STMT, IF(isnan(from_unixtime(unix_timestamp(ambs_date_late_fee), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_late_fee, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_LATE_FEE, IF(isnan(from_unixtime(unix_timestamp(ambs_date_notific_recvd), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_notific_recvd, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_NOTIFIC_RECVD, IF(isnan(from_unixtime(unix_timestamp(ambs_date_pmt_due), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_pmt_due, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_PMT_DUE, IF(isnan(from_unixtime(unix_timestamp(ambs_date_xfr_eff), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_date_xfr_eff, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_DATE_XFR_EFF, trim(ambs_fi_coll_class) AS AMBS_FI_COLL_CLASS, substring((ambs_fi_spid + 1000), 0,1) AS AMBS_FI_SPID, trim(ambs_fs_flag) AS AMBS_FS_FLAG, IF(isnan(from_unixtime(unix_timestamp(ambs_grtst_card_expr_date), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_grtst_card_expr_date, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_GRTST_CARD_EXPR_DATE, IF(isnan(ambs_last_crlim), '',ambs_last_crlim) AS AMBS_LAST_CRLIM, IF(isnan(ambs_last_ytd_int), '',ambs_last_ytd_int) AS AMBS_LAST_YTD_INT, IF(isnan(ambs_last_ytd_int_paid), '',ambs_last_ytd_int_paid) AS AMBS_LAST_YTD_INT_PAID, substring((ambs_lsi_nbr + 1000), 0,1) AS AMBS_LSI_NBR, IF(isnan(rint(ambs_open_to_buy)), '',ambs_open_to_buy) AS AMBS_OPEN_TO_BUY, trim(ambs_owner_flag) AS AMBS_OWNER_FLAG, IF(isnan(rint(ambs_pmt_curr_due)), '',ambs_pmt_curr_due) AS AMBS_PMT_CURR_DUE, IF(isnan(rint(ambs_pmt_past_due)), '',ambs_pmt_past_due) AS AMBS_PMT_PAST_DUE, IF(isnan(rint(ambs_pmt_30days)), '',ambs_pmt_30days) AS AMBS_PMT_30DAYS, IF(isnan(rint(ambs_pmt_60days)), '',ambs_pmt_60days) AS AMBS_PMT_60DAYS, IF(isnan(rint(ambs_pmt_90days)), '',ambs_pmt_90days) AS AMBS_PMT_90DAYS, IF(isnan(rint(ambs_pmt_120days)), '',ambs_pmt_120days) AS AMBS_PMT_120DAYS, IF(isnan(rint(ambs_pmt_150days)), '',ambs_pmt_150days) AS AMBS_PMT_150DAYS, IF(isnan(rint(ambs_pmt_180days)), '',ambs_pmt_180days) AS AMBS_PMT_180DAYS, IF(isnan(rint(ambs_pmt_last_amt)), '',ambs_pmt_last_amt) AS AMBS_PMT_LAST_AMT, IF(isnan(from_unixtime(unix_timestamp(ambs_user_date_8), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_user_date_8, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_USER_DATE_8, IF(isnan(from_unixtime(unix_timestamp(ambs_pct_start_date), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_pct_start_date, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_PCT_START_DATE, IF(isnan(from_unixtime(unix_timestamp(ambs_pct_expir_date), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_pct_expir_date, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_PCT_EXPIR_DATE, IF(ambs_acct_type = 'X', ambs_state_of_issue, ambs_state_of_resid) AS STANDARD_PRICING_CONTROL_TABLE_ID, IF (ambs_acct_type = 'X', substring((ambs_bu_appl_store_nbr + 10000000000), 0,1), substring((ambs_si_nbr + 10000000000), 0,1)  ) AS STORE_NUMBER, substring(ambs_acct,3,6) AS ACCOUNT_BIN, format_number(rint((rint(ambs_amt_cgoff) +rint(ambs_cash_amt_chgoff))/100), 2) AS TOTAL_CHARGE_OFF_AMOUNT, NULL AS E_STATEMENT_DELIVERY_CODE_DATE, IF (ambs_acct_type = 'X', substring((ambs_retail_plan_nbr + 100000), 0,1), substring((ambs_bu_std_plan + 100000), 0,1)  ) AS STANDARD_PURCHASE_PLAN_NUMBER, IF(isnan(rint(ambs_cash_crlim)), '',ambs_cash_crlim) AS AMBS_CASH_CRLIM, IF(isnan(rint(ambs_first_purch_amt)), '',ambs_first_purch_amt) AS AMBS_FIRST_PURCH_AMT, IF(isnan(from_unixtime(unix_timestamp(ambs_first_purch_dte), 'yyyyDDD')), '', date_format(from_unixtime(unix_timestamp(ambs_first_purch_dte, 'yyyyD')), 'yyyyMMdd') ) AS AMBS_FIRST_PURCH_DTE, trim(ambs_h_bal_0) AS AMBS_H_BAL_0, substring((ambs_olc_reason + 1000), 0,1) AS AMBS_OLC_REASON, IF((ambs_cb_cr_score > 999), '0', ambs_cb_cr_score), IF((ambs_pct_ctl_id = '~'), '', ambs_pct_ctl_id), ambs_block_code_1 AS BLOCK_CODE_1, ambs_block_code_2 AS BLOCK_CODE_2, ambs_crlim AS CREDIT_LIMIT, ambs_int_status AS INTERNAL_STATUS_CODE, ambs_pmt_tot_amt_due AS TOTAL_AMOUNT_DUE, FIXED_PAYMENT_PERCENTAGE_OR_AMOUNT AS FIXED_PAYMENT_PERCENTAGE_OR_AMOUNT, ambs_amt_last_purch AS LAST_PURCHASE_AMOUNT, ambs_amt_cgoff AS PURCHASE_CHARGE_OFF_AMOUNT, ambs_cash_amt_chgoff AS CASH_CHARGE_OFF_AMOUNT, ambs_chgoff_status AS CHARGE_OFF_STATUS_CODE, ambs_chgoff_rsn1 AS CHARGE_OFF_REASON_CODE_1, ambs_chgoff_rsn2 AS CHARGE_OFF_REASON_CODE_2, ambs_amt_dispu_items AS DISPUTED_AMOUNT, ambs_nbr_dispu_items AS DISPUTED_ITEMS_QUANTITY, ambs_amt_last_db AS LAST_DEBIT_AMOUNT, ambs_amt_ltd_int_paid AS INTEREST_PAID_LIFE_TO_DATE, ambs_amt_ltd_pmts AS PAYMENT_AMOUNT_LIFE_TO_DATE, ambs_amt_ltd_purchases AS PURCHASE_AMOUNT_LIFE_TO_DATE, ambs_nbr_ltd_pmts AS PAYMENT_QUANTITY_LIFE_TO_DATE, ambs_nbr_ltd_purchases AS PURCHASE_QUANTITY_LIFE_TO_DATE, ambs_nbr_ltd_returns AS RETURN_QUANTITY_LIFE_TO_DATE, ambs_nbr_ltd_cash AS CASH_QUANTITY_LIFE_TO_DATE, ambs_amt_memo_cr AS MEMO_CREDIT_AMOUNT, ambs_amt_memo_db AS MEMO_DEBIT_AMOUNT, CASH_AMOUNT_YEAR_TO_DATE AS CASH_AMOUNT_YEAR_TO_DATE, ambs_curr_ytd_int_paid AS INTEREST_PAID_YEAR_TO_DATE, ambs_hi_ag_partner_code AS BRANDING_GROUP_SECTION_1_CODE, ambs_hi_ag_affinity_code AS BRANDING_GROUP_SECTION_2_CODE, ambs_hi_ag_affiliation_code AS BRANDING_GROUP_SECTION_3_CODE, ambs_hi_ag_sub_affiltn_code AS BRANDING_GROUP_SECTION_4_CODE, ambs_bu_channel_code AS ORIGINATION_CHANNEL_CODE, ambs_bu_fi_cs_ind AS CREDIT_STEPS_CODE, ambs_bu_lost_stln_type_cd AS LOST_CARD_CODE, ambs_bu_merch_source_code AS MARKETING_PROMO_CODE, ambs_bu_metro2_code_1 AS CREDIT_BUREAU_DISPUTE_CODE, ambs_bu_scra_status_0 AS ambs_bu_scra_status_0, ambs_hi_acct_transact_revol AS ambs_hi_acct_transact_revol, ambs_hi_cit_alt_pct AS ambs_hi_cit_alt_pct, ambs_hi_cpi_ind AS ambs_hi_cpi_ind, ambs_bu_fraud_fix_pmt AS ambs_bu_fraud_fix_pmt, ambs_hi_user_code_28 AS ambs_hi_user_code_28, ambs_hi_user_code_29 AS ambs_hi_user_code_29, ambs_issue_flag AS ambs_issue_flag, ambs_mth_bal AS ambs_mth_bal, ambs_mth_purch AS ambs_mth_purch, ambs_nbr_nsf AS ambs_nbr_nsf, ambs_nbr_plans AS ambs_nbr_plans, ambs_nbr_unblked_cards AS ambs_nbr_unblked_cards, ambs_nbr_ytd_late_chg AS ambs_nbr_ytd_late_chg, ambs_nbr_ytd_purchases AS ambs_nbr_ytd_purchases, ambs_nbr_ytd_returns AS ambs_nbr_ytd_returns, ambs_plan_pmt_ovrd_flag AS ambs_plan_pmt_ovrd_flag, ambs_pmt_past_ctr AS ambs_pmt_past_ctr, ambs_pmt_30days_ctr AS ambs_pmt_30days_ctr, ambs_pmt_60days_ctr AS ambs_pmt_60days_ctr, ambs_pmt_90days_ctr AS ambs_pmt_90days_ctr, ambs_pmt_120_days_ctr AS ambs_pmt_120_days_ctr, ambs_pmt_150_days_ctr AS ambs_pmt_150_days_ctr, ambs_pmt_180_days_ctr AS ambs_pmt_180_days_ctr, ambs_pmt_days_delq AS ambs_pmt_days_delq, ambs_pmt_times_manual_reage AS ambs_pmt_times_manual_reage, ambs_rtn_mail_ctr AS ambs_rtn_mail_ctr, ambs_statement_flag AS ambs_statement_flag, ambs_user_code_8 AS ambs_user_code_8, +ambs_ytd_billed_int AS ambs_ytd_billed_int, ambs_intr_state AS ambs_intr_state, ambs_billing_cycle AS ambs_billing_cycle, ambs_acct_type AS ambs_acct_type, LATE_FEE_AMOUNT_YEAR_TO_DATE AS LATE_FEE_AMOUNT_YEAR_TO_DATE, PAYMENT_AMOUNT_YEAR_TO_DATE AS PAYMENT_AMOUNT_YEAR_TO_DATE, PURCHASE_AMOUNT_YEAR_TO_DATE AS PURCHASE_AMOUNT_YEAR_TO_DATE, RETURN_AMOUNT_YEAR_TO_DATE AS RETURN_AMOUNT_YEAR_TO_DATE, OPEN_IND AS OPEN_IND, OVERRIDE_PRICING_TYPE AS OVERRIDE_PRICING_TYPE, NEXT_PAYMENT_DUE_DATE AS NEXT_PAYMENT_DUE_DATE, CYCLES_OPEN AS CYCLES_OPEN, ambs_bu_sister_acct AS DUAL_ACCOUNT_ATH_CHAIN_NUMBER, ambs_bu_sister_acct AS DUAL_ACCOUNT_ATH_SEQUENCE_NUMBER, ambs_h_delq_0 AS ambs_h_delq_0, ambs_h_delq_1 AS ambs_h_delq_1, HIGHEST_AGE_LAST_24_MONTHS AS HIGHEST_AGE_LAST_24_MONTHS, past_due_last12_mth AS past_due_last12_mth, past_due_last24_mth AS past_due_last24_mth, 30_DAYS_DELINQUENT_QUANTITY_LAST_12_MONTHS AS 30DAYS_DELINQUENT_QUANTITY_LAST_12_MONTHS, 30_DAYS_DELINQUENT_QUANTITY_LAST_13_24_MONTHS AS 30_DAYS_DELINQUENT_QUANTITY_LAST_13_24_MONTHS, 60_DAYS_DELINQUENT_QUANTITY_LAST_12_MONTHS AS 60_DAYS_DELINQUENT_QUANTITY_LAST_12_MONTHS, 60_DAYS_DELINQUENT_QUANTITY_LAST_13_24_MONTHS AS 60_DAYS_DELINQUENT_QUANTITY_LAST_13_24_MONTHS, 90_PLUS_DAYS_DELINQUENT_QUANTITY_LAST_12_MONTHS AS 90_PLUS_DAYS_DELINQUENT_QUANTITY_LAST_12_MONTHS, 90_PLUS_DAYS_DELINQUENT_QUANTITY_LAST_13_24_MONTHS AS 90_PLUS_DAYS_DELINQUENT_QUANTITY_LAST_13_24_MONTHS, ambs_pmt_ratios_0 AS ambs_pmt_ratios_0, ambs_pmt_ratios_1 AS ambs_pmt_ratios_1, PRICING_TYPE AS PRICING_TYPE, PRICE_METHOD_CODE AS PRICE_METHOD_CODE FROM BigTrans10_11")

    FinalTransformations.registerTempTable("FinalTransformations")



    FinalTransformations.rdd.saveAsTextFile(outputFile)

    val endtimestamp = Calendar.getInstance().getTime()

    printf("The program finished executing at: " + endtimestamp + "\n")

    sc.stop()

  }

}